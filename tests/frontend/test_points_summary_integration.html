<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PointsSummary Integration Test</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--color-soft-gray);
      padding: 20px;
    }

    .test-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .test-header {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-soft);
    }

    .test-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-soft);
    }

    .test-section h3 {
      margin-top: 0;
      color: var(--color-text-primary);
    }

    .test-result {
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
    }

    .test-result.pass {
      background: var(--color-mint);
      color: var(--color-text-primary);
    }

    .test-result.fail {
      background: #FFE5E5;
      color: #C53030;
    }

    button {
      padding: 10px 20px;
      background: var(--color-deep-blue);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      background: var(--color-calm-blue);
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>PointsSummary Integration Test</h1>
      <p>Automated tests for PointsSummary component functionality.</p>
    </div>

    <div class="test-section">
      <h3>Test Controls</h3>
      <button onclick="runAllTests()">Run All Tests</button>
      <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="test-results" class="test-section">
      <h3>Test Results</h3>
      <div id="results-container">
        <p>Click "Run All Tests" to begin testing.</p>
      </div>
    </div>

    <div id="points-summary-container"></div>
  </div>

  <script>
    // Mock app state
    let mockState = {
      userPoints: {
        date: new Date().toISOString().split('T')[0],
        totalPoints: 0,
        actionsCompleted: 0,
        vapePoints: 0,
        smokePoints: 0,
        actions: []
      }
    };

    // Mock BreatheBackApp
    window.BreatheBackApp = {
      getState: () => mockState,
      updatePoints: (points) => {
        mockState.userPoints = points;
      }
    };

    let testResults = [];

    function addTestResult(testName, passed, message) {
      testResults.push({ testName, passed, message });
      displayResults();
    }

    function displayResults() {
      const container = document.getElementById('results-container');
      container.innerHTML = '';

      if (testResults.length === 0) {
        container.innerHTML = '<p>No tests run yet.</p>';
        return;
      }

      const passCount = testResults.filter(r => r.passed).length;
      const failCount = testResults.filter(r => !r.passed).length;

      container.innerHTML = `<p><strong>Tests: ${testResults.length} | Passed: ${passCount} | Failed: ${failCount}</strong></p>`;

      testResults.forEach(result => {
        const div = document.createElement('div');
        div.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
        div.innerHTML = `
          <strong>${result.passed ? '✓' : '✗'} ${result.testName}</strong><br>
          ${result.message}
        `;
        container.appendChild(div);
      });
    }

    function clearResults() {
      testResults = [];
      displayResults();
    }

    // Test 1: Component initializes correctly
    function testInitialization() {
      try {
        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        const container = document.getElementById('points-summary-container');
        const hasContent = container.innerHTML.trim().length > 0;

        if (hasContent) {
          addTestResult('Initialization', true, 'Component initialized and rendered successfully');
        } else {
          addTestResult('Initialization', false, 'Component did not render content');
        }
      } catch (error) {
        addTestResult('Initialization', false, `Error: ${error.message}`);
      }
    }

    // Test 2: Zero points message (Requirement 8.5)
    function testZeroPointsMessage() {
      try {
        mockState.userPoints = {
          date: new Date().toISOString().split('T')[0],
          totalPoints: 0,
          actionsCompleted: 0,
          vapePoints: 0,
          smokePoints: 0,
          actions: []
        };

        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        const container = document.getElementById('points-summary-container');
        const message = container.textContent;

        if (message.includes('Ready to help the air heal today?')) {
          addTestResult('Zero Points Message', true, 'Correct message displayed for 0 points');
        } else {
          addTestResult('Zero Points Message', false, 'Expected "Ready to help the air heal today?" message');
        }
      } catch (error) {
        addTestResult('Zero Points Message', false, `Error: ${error.message}`);
      }
    }

    // Test 3: Low points message (1-20 points)
    function testLowPointsMessage() {
      try {
        mockState.userPoints = {
          date: new Date().toISOString().split('T')[0],
          totalPoints: 15,
          actionsCompleted: 3,
          vapePoints: 10,
          smokePoints: 5,
          actions: []
        };

        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        const container = document.getElementById('points-summary-container');
        const message = container.textContent;

        if (message.includes('Small actions add up—nice work')) {
          addTestResult('Low Points Message', true, 'Correct message displayed for 1-20 points');
        } else {
          addTestResult('Low Points Message', false, 'Expected "Small actions add up" message');
        }
      } catch (error) {
        addTestResult('Low Points Message', false, `Error: ${error.message}`);
      }
    }

    // Test 4: Medium points message (21-50 points)
    function testMediumPointsMessage() {
      try {
        mockState.userPoints = {
          date: new Date().toISOString().split('T')[0],
          totalPoints: 35,
          actionsCompleted: 7,
          vapePoints: 20,
          smokePoints: 15,
          actions: []
        };

        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        const container = document.getElementById('points-summary-container');
        const message = container.textContent;

        if (message.includes('helped') && message.includes('healing today')) {
          addTestResult('Medium Points Message', true, 'Correct message displayed for 21-50 points');
        } else {
          addTestResult('Medium Points Message', false, 'Expected "helped X spaces" message');
        }
      } catch (error) {
        addTestResult('Medium Points Message', false, `Error: ${error.message}`);
      }
    }

    // Test 5: High points message (51+ points)
    function testHighPointsMessage() {
      try {
        mockState.userPoints = {
          date: new Date().toISOString().split('T')[0],
          totalPoints: 75,
          actionsCompleted: 15,
          vapePoints: 40,
          smokePoints: 35,
          actions: []
        };

        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        const container = document.getElementById('points-summary-container');
        const message = container.textContent;

        if (message.includes('Amazing effort') && message.includes('community feels your impact')) {
          addTestResult('High Points Message', true, 'Correct message displayed for 51+ points');
        } else {
          addTestResult('High Points Message', false, 'Expected "Amazing effort" message');
        }
      } catch (error) {
        addTestResult('High Points Message', false, `Error: ${error.message}`);
      }
    }

    // Test 6: Breakdown display (Requirement 8.4)
    function testBreakdownDisplay() {
      try {
        mockState.userPoints = {
          date: new Date().toISOString().split('T')[0],
          totalPoints: 35,
          actionsCompleted: 7,
          vapePoints: 20,
          smokePoints: 15,
          actions: []
        };

        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        const container = document.getElementById('points-summary-container');
        const hasBreakdown = container.textContent.includes('Breakdown');
        const hasVape = container.textContent.includes('Vape Restoration');
        const hasSmoke = container.textContent.includes('Smoke Restoration');

        if (hasBreakdown && hasVape && hasSmoke) {
          addTestResult('Breakdown Display', true, 'Breakdown section displayed with vape and smoke points');
        } else {
          addTestResult('Breakdown Display', false, 'Breakdown section missing or incomplete');
        }
      } catch (error) {
        addTestResult('Breakdown Display', false, `Error: ${error.message}`);
      }
    }

    // Test 7: No breakdown for zero points
    function testNoBreakdownForZero() {
      try {
        mockState.userPoints = {
          date: new Date().toISOString().split('T')[0],
          totalPoints: 0,
          actionsCompleted: 0,
          vapePoints: 0,
          smokePoints: 0,
          actions: []
        };

        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        const container = document.getElementById('points-summary-container');
        const hasBreakdown = container.textContent.includes('Breakdown');

        if (!hasBreakdown) {
          addTestResult('No Breakdown for Zero', true, 'Breakdown correctly hidden for 0 points');
        } else {
          addTestResult('No Breakdown for Zero', false, 'Breakdown should not display for 0 points');
        }
      } catch (error) {
        addTestResult('No Breakdown for Zero', false, `Error: ${error.message}`);
      }
    }

    // Test 8: Daily reset check (Requirement 8.3)
    function testDailyResetCheck() {
      try {
        // Set points with yesterday's date
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];

        mockState.userPoints = {
          date: yesterdayStr,
          totalPoints: 50,
          actionsCompleted: 10,
          vapePoints: 30,
          smokePoints: 20,
          actions: []
        };

        const component = new PointsSummary({
          containerId: 'points-summary-container'
        });
        component.init();

        // Check if points were reset
        const today = new Date().toISOString().split('T')[0];
        if (mockState.userPoints.date === today && mockState.userPoints.totalPoints === 0) {
          addTestResult('Daily Reset Check', true, 'Points correctly reset for new day');
        } else {
          addTestResult('Daily Reset Check', false, 'Points were not reset for new day');
        }
      } catch (error) {
        addTestResult('Daily Reset Check', false, `Error: ${error.message}`);
      }
    }

    function runAllTests() {
      clearResults();
      
      testInitialization();
      testZeroPointsMessage();
      testLowPointsMessage();
      testMediumPointsMessage();
      testHighPointsMessage();
      testBreakdownDisplay();
      testNoBreakdownForZero();
      testDailyResetCheck();
    }
  </script>

  <script src="pointsSummary.js"></script>
</body>
</html>
