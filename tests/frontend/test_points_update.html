<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Points Update Test</title>
    <link rel="stylesheet" href="../../frontend/styles.css">
    <style>
        body {
            padding: 20px;
            background: var(--color-sky-blue);
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .test-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .test-status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .test-pass {
            background: #C6F6D5;
            color: #22543D;
        }
        .test-fail {
            background: #FED7D7;
            color: #742A2A;
        }
        .test-info {
            background: #E8F4F8;
            color: #2C5282;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #F5F7FA;
            border-radius: 8px;
        }
        .test-button {
            padding: 10px 20px;
            background: #6BC4A6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        .test-button:hover {
            background: #5AB396;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>Points Update Test</h1>
            <p>Testing snake_case to camelCase conversion and points display</p>
        </div>
        
        <div id="test-results"></div>
        
        <div class="test-section">
            <h3>Test Actions</h3>
            <button class="test-button" onclick="testSnakeCaseUpdate()">Test Snake Case Update</button>
            <button class="test-button" onclick="testCamelCaseUpdate()">Test Camel Case Update</button>
            <button class="test-button" onclick="testMixedUpdate()">Test Mixed Update</button>
            <button class="test-button" onclick="refreshDisplay()">Refresh Display</button>
        </div>
        
        <div id="points-summary-container"></div>
    </div>

    <script src="../../frontend/pointsSummary.js"></script>
    <script src="../../frontend/app.js"></script>
    <script>
        const testResults = document.getElementById('test-results');
        
        function addTestResult(message, status) {
            const div = document.createElement('div');
            div.className = `test-status test-${status}`;
            div.textContent = message;
            testResults.appendChild(div);
        }
        
        // Initialize app state
        if (window.BreatheBackApp) {
            window.BreatheBackApp.initializeApp();
            addTestResult('✓ BreatheBackApp initialized', 'pass');
        }
        
        // Initialize PointsSummary
        let pointsSummary;
        try {
            pointsSummary = new PointsSummary({
                containerId: 'points-summary-container'
            });
            pointsSummary.init();
            addTestResult('✓ PointsSummary initialized', 'pass');
        } catch (error) {
            addTestResult(`✗ PointsSummary initialization failed: ${error.message}`, 'fail');
        }
        
        function testSnakeCaseUpdate() {
            addTestResult('Testing snake_case update (from API)...', 'info');
            const snakeCaseData = {
                date: '2024-01-15',
                total_points: 45,
                actions_completed: 3,
                vape_points: 25,
                smoke_points: 20,
                actions: []
            };
            
            window.BreatheBackApp.updatePoints(snakeCaseData);
            const state = window.BreatheBackApp.getState();
            
            console.log('After snake_case update:', state.userPoints);
            
            if (state.userPoints.totalPoints === 45 && 
                state.userPoints.actionsCompleted === 3 &&
                state.userPoints.vapePoints === 25 &&
                state.userPoints.smokePoints === 20) {
                addTestResult('✓ Snake case converted correctly to camelCase', 'pass');
            } else {
                addTestResult('✗ Snake case conversion failed', 'fail');
                console.error('Expected: 45, 3, 25, 20');
                console.error('Got:', state.userPoints);
            }
            
            pointsSummary.update();
        }
        
        function testCamelCaseUpdate() {
            addTestResult('Testing camelCase update (from frontend)...', 'info');
            const camelCaseData = {
                date: '2024-01-15',
                totalPoints: 60,
                actionsCompleted: 4,
                vapePoints: 35,
                smokePoints: 25,
                actions: []
            };
            
            window.BreatheBackApp.updatePoints(camelCaseData);
            const state = window.BreatheBackApp.getState();
            
            console.log('After camelCase update:', state.userPoints);
            
            if (state.userPoints.totalPoints === 60 && 
                state.userPoints.actionsCompleted === 4 &&
                state.userPoints.vapePoints === 35 &&
                state.userPoints.smokePoints === 25) {
                addTestResult('✓ CamelCase data preserved correctly', 'pass');
            } else {
                addTestResult('✗ CamelCase data not preserved', 'fail');
            }
            
            pointsSummary.update();
        }
        
        function testMixedUpdate() {
            addTestResult('Testing mixed case update...', 'info');
            const mixedData = {
                date: '2024-01-15',
                total_points: 80,
                actionsCompleted: 5,  // camelCase
                vape_points: 50,
                smokePoints: 30,  // camelCase
                actions: []
            };
            
            window.BreatheBackApp.updatePoints(mixedData);
            const state = window.BreatheBackApp.getState();
            
            console.log('After mixed update:', state.userPoints);
            
            if (state.userPoints.totalPoints === 80 && 
                state.userPoints.actionsCompleted === 5 &&
                state.userPoints.vapePoints === 50 &&
                state.userPoints.smokePoints === 30) {
                addTestResult('✓ Mixed case handled correctly', 'pass');
            } else {
                addTestResult('✗ Mixed case handling failed', 'fail');
            }
            
            pointsSummary.update();
        }
        
        function refreshDisplay() {
            pointsSummary.update();
            addTestResult('Display refreshed', 'info');
        }
        
        // Run initial test
        setTimeout(() => {
            addTestResult('Running initial snake_case test...', 'info');
            testSnakeCaseUpdate();
        }, 500);
    </script>
</body>
</html>
