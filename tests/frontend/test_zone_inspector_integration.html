<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZoneInspector Integration Test</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
  
  <link rel="stylesheet" href="styles.css">
  
  <style>
    body {
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .test-container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      color: #4A5568;
      margin-bottom: 30px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .test-section h2 {
      margin-bottom: 15px;
      color: #4A5568;
      font-size: 18px;
    }
    
    .test-section p {
      margin-bottom: 15px;
      color: #718096;
      font-size: 14px;
    }
    
    #map-container {
      height: 400px;
      margin-bottom: 20px;
    }
    
    .status {
      padding: 10px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 14px;
    }
    
    .status.success {
      background: #D4F1E8;
      color: #52BE80;
    }
    
    .status.info {
      background: #E8F4F8;
      color: #5A9FBE;
    }
    
    .test-instructions {
      padding: 15px;
      background: #FFF4D6;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .test-instructions ol {
      margin: 10px 0 0 20px;
      padding: 0;
    }
    
    .test-instructions li {
      margin-bottom: 8px;
      color: #4A5568;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üó∫Ô∏è ZoneInspector + HeatmapView Integration Test</h1>
    
    <div class="test-instructions">
      <strong>Test Instructions:</strong>
      <ol>
        <li>The map below shows sample zones in different restoration states</li>
        <li>Click on any colored zone rectangle to open the Zone Inspector</li>
        <li>Verify the inspector shows the correct state message</li>
        <li>Click the close button (√ó) or press Escape to close</li>
        <li>Try clicking different zones to see different states</li>
      </ol>
    </div>
    
    <div class="test-section">
      <h2>Interactive Heatmap with Zone Inspector</h2>
      <p>Click on any zone to inspect its restoration state.</p>
      
      <div id="map-toggle-container"></div>
      <div id="map-container"></div>
      <div id="map-legend-container"></div>
      
      <div class="status info" id="status">
        Status: Ready. Click on a zone to test the inspector.
      </div>
    </div>
  </div>
  
  <!-- Zone Inspector Container -->
  <div id="zone-inspector-container" class="hidden"></div>
  
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>
  
  <!-- Application Scripts -->
  <script src="heatmapView.js"></script>
  <script src="zoneInspector.js"></script>
  
  <script>
    // Create sample zones for testing
    function createSampleZones() {
      // San Francisco area zones
      const baseLatitude = 37.7749;
      const baseLongitude = -122.4194;
      const gridSize = 0.01;
      
      const zones = [];
      
      // Create a grid of zones with different states
      const zoneConfigs = [
        // Needs restoration zones (yellow)
        { lat: 0, lng: 0, vapeDebt: 50, vapeRestore: 10, smokeDebt: 40, smokeRestore: 5 },
        { lat: 0, lng: 1, vapeDebt: 60, vapeRestore: 15, smokeDebt: 50, smokeRestore: 10 },
        { lat: 1, lng: 0, vapeDebt: 45, vapeRestore: 8, smokeDebt: 55, smokeRestore: 12 },
        
        // Healing zones (green)
        { lat: 1, lng: 1, vapeDebt: 30, vapeRestore: 25, smokeDebt: 35, smokeRestore: 30 },
        { lat: 0, lng: -1, vapeDebt: 25, vapeRestore: 20, smokeDebt: 28, smokeRestore: 22 },
        { lat: -1, lng: 0, vapeDebt: 32, vapeRestore: 28, smokeDebt: 30, smokeRestore: 25 },
        
        // Recovered zones (blue)
        { lat: -1, lng: -1, vapeDebt: 20, vapeRestore: 50, smokeDebt: 15, smokeRestore: 45 },
        { lat: 1, lng: -1, vapeDebt: 10, vapeRestore: 40, smokeDebt: 12, smokeRestore: 38 },
        { lat: -1, lng: 1, vapeDebt: 18, vapeRestore: 55, smokeDebt: 20, smokeRestore: 50 }
      ];
      
      zoneConfigs.forEach((config, index) => {
        const lat = baseLatitude + (config.lat * gridSize);
        const lng = baseLongitude + (config.lng * gridSize);
        
        zones.push({
          id: `zone_${Math.floor(lat * 100)}_${Math.floor(lng * 100)}`,
          bounds: {
            north: lat + gridSize / 2,
            south: lat - gridSize / 2,
            east: lng + gridSize / 2,
            west: lng - gridSize / 2
          },
          vapeDebt: config.vapeDebt,
          vapeRestore: config.vapeRestore,
          smokeDebt: config.smokeDebt,
          smokeRestore: config.smokeRestore
        });
      });
      
      return zones;
    }
    
    // Initialize components
    let heatmapView;
    let zoneInspector;
    let clickCount = 0;
    
    function init() {
      // Create sample zones
      const zones = createSampleZones();
      
      // Initialize ZoneInspector
      zoneInspector = new ZoneInspector({
        containerId: 'zone-inspector-container',
        onClose: (zoneInfo) => {
          console.log('Zone inspector closed:', zoneInfo);
          updateStatus('Inspector closed. Click another zone to test again.', 'info');
        }
      });
      zoneInspector.init();
      
      // Initialize HeatmapView
      heatmapView = new HeatmapView({
        mapContainerId: 'map-container',
        toggleContainerId: 'map-toggle-container',
        legendContainerId: 'map-legend-container',
        mapType: 'vape',
        onMapTypeToggle: (type) => {
          console.log('Map type toggled:', type);
          updateStatus(`Map type changed to: ${type}`, 'info');
          heatmapView.renderZones(zones, type);
        },
        onZoneTap: (zoneInfo) => {
          console.log('Zone tapped:', zoneInfo);
          clickCount++;
          
          // Show zone inspector
          zoneInspector.show(zoneInfo);
          
          updateStatus(
            `Zone clicked (${clickCount} times). Inspector showing: "${zoneInfo.message}"`,
            'success'
          );
        }
      });
      heatmapView.init();
      
      // Render zones on the map
      heatmapView.renderZones(zones, 'vape');
      
      console.log('Integration test initialized with', zones.length, 'zones');
    }
    
    function updateStatus(message, type) {
      const statusElement = document.getElementById('status');
      if (statusElement) {
        statusElement.textContent = 'Status: ' + message;
        statusElement.className = 'status ' + type;
      }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
